{"ast":null,"code":"var _jsxFileName = \"/Users/guanlun/Documents/GitHub/myblog/src/components/Textcontent/Textcontent.js\";\nimport React from 'react';\nimport './Textcontent.css';\n\nconst Textcontent = () => {\n  return /*#__PURE__*/React.createElement(\"div\", {\n    className: \"Textcontent\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 6,\n      columnNumber: 9\n    }\n  }, /*#__PURE__*/React.createElement(\"article\", {\n    id: \"post__content\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 7,\n      columnNumber: 13\n    }\n  }, /*#__PURE__*/React.createElement(\"h1\", {\n    id: \"post__title\",\n    \"data-identifier\": \"20140903\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 8,\n      columnNumber: 17\n    }\n  }, \"\\u7528 Redis \\u5B9E\\u73B0\\u4E92\\u65A5\\u9501\"), /*#__PURE__*/React.createElement(\"p\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 9,\n      columnNumber: 17\n    }\n  }, \"\\u5728\", /*#__PURE__*/React.createElement(\"a\", {\n    href: \"https://zh.wikipedia.org/wiki/\\u591A\\u7EBF\\u7A0B\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 9,\n      columnNumber: 21\n    }\n  }, \"\\u591A\\u7EBF\\u7A0B\"), \"\\u6267\\u884C\\u7684\\u7A0B\\u5E8F\\u4E0B\\uFF0C\\u65E0\\u53EF\\u907F\\u514D\\u7684\\u4F1A\\u9047\\u5230\\u8D44\\u6E90\\u7ADE\\u4E89\\u7684\\u95EE\\u9898\\uFF0C\\u4E3A\\u4E86\\u89E3\\u51B3\\u8D44\\u6E90\\u7ADE\\u4E89\\u7684\\u95EE\\u9898\\uFF0C\\u5F15\\u5165\", /*#__PURE__*/React.createElement(\"a\", {\n    href: \"https://zh.wikipedia.org/wiki/\\u4E92\\u65A5\\u9501\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 9,\n      columnNumber: 109\n    }\n  }, \"\\u4E92\\u65A5\\u9501\"), \"\\u5E94\\u8BE5\\u662F\\u516C\\u8BA4\\u7684\\u89E3\\u51B3\\u65B9\\u6848\\u5427\\uFF0C\\u800C Redis \\u7684\\u7279\\u6027\\uFF08\\u57FA\\u4E8E\\u5185\\u5B58\\uFF0C\\u6709\\u751F\\u5B58\\u671F\\uFF09\\u6211\\u89C9\\u5F97\\u975E\\u5E38\\u9002\\u5408\\u7528\\u6765\\u5B9E\\u73B0\\u4E92\\u65A5\\u9501\\u3002\"), /*#__PURE__*/React.createElement(\"h2\", {\n    id: \"section\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 11,\n      columnNumber: 17\n    }\n  }, \"\\u80CC\\u666F\"), /*#__PURE__*/React.createElement(\"p\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 13,\n      columnNumber: 17\n    }\n  }, \"\\u6211\\u9047\\u5230\\u7684\\u95EE\\u9898\\u662F\\u5728\\u5BF9 \", /*#__PURE__*/React.createElement(\"a\", {\n    href: \"https://lucene.apache.org\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 13,\n      columnNumber: 30\n    }\n  }, \"Lucene\"), \" \\u66F4\\u65B0\\u7D22\\u5F15\\u7684\\u65F6\\u5019\\uFF0C\\u539F\\u6765\\u91C7\\u53D6\\u7684\\u7B56\\u7565\\u662F\\u5C06\\u67D0\\u4E2A\\u6570\\u636E\\u8868\\u589E\\u91CF\\u7684\\u6570\\u636E\\u901A\\u8FC7\\u4E00\\u4E2A\\u7EBF\\u7A0B\\u5B9A\\u671F\\u53BB\\u66F4\\u65B0\\u548C flush \\u7D22\\u5F15\\u6587\\u4EF6\\uFF0C\\u4F46\\u7531\\u4E8E\\u4E1A\\u52A1\\u7684\\u6269\\u5C55\\uFF0C\\u539F\\u6765\\u7684\\u4E1A\\u52A1\\u53D8\\u6210\\u4E86\\u4ECE2\\u4E2A\\u4E0D\\u540C\\u7684\\u6570\\u636E\\u8868\\u75282\\u4E2A\\u4E0D\\u540C\\u7684\\u5B9A\\u671F\\u7EBF\\u7A0B\\u53BB\\u66F4\\u65B0\\u3002\"), /*#__PURE__*/React.createElement(\"p\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 15,\n      columnNumber: 17\n    }\n  }, \"\\u8FD9\\u4E2A\\u65F6\\u5019\\u95EE\\u9898\\u6765\\u4E86\\uFF0C\\u5728 flush \\u5230\\u6587\\u4EF6\\u7CFB\\u7EDF\\u4E2D\\u7684\\u65F6\\u5019\\uFF0C\\u867D\\u7136 Lucene \\u672C\\u8EAB\\u521B\\u5EFA\\u4E86\\u4E00\\u4E2A \", /*#__PURE__*/React.createElement(\"code\", {\n    class: \"highlighter-rouge\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 15,\n      columnNumber: 65\n    }\n  }, \"write.lock\"), \" \\u6765\\u907F\\u514D\\u6587\\u4EF6\\u51B2\\u7A81\\uFF0C\\u4F46\\u662F\\u7531\\u4E8E\\u7EBF\\u7A0B\\u4E2D\\u8FD0\\u884C\\u7684\\u7A0B\\u5E8F\\u5728 flush \\u8FC7\\u7A0B\\u4E2D\\u53EF\\u80FD\\u56E0\\u4E3A\\u5F02\\u5E38\\u5BFC\\u81F4\\u7EBF\\u7A0B\\u76F4\\u63A5\\u4E2D\\u65AD\\uFF0C\\u5BFC\\u81F4 \", /*#__PURE__*/React.createElement(\"code\", {\n    class: \"highlighter-rouge\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 15,\n      columnNumber: 164\n    }\n  }, \"write.lock\"), \" \\u6587\\u4EF6\\u6CA1\\u6709\\u88AB\\u53CA\\u65F6\\u6E05\\u9664\\u548C\\u5904\\u7406\\uFF0C\\u540E\\u7EED\\u7684\\u7D22\\u5F15\\u66F4\\u65B0\\u7EBF\\u7A0B\\u5168\\u90E8\\u4F5C\\u5E9F\\u3002\"), /*#__PURE__*/React.createElement(\"h2\", {\n    id: \"section-1\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 17,\n      columnNumber: 17\n    }\n  }, \"\\u89E3\\u51B3\\u65B9\\u6848\"), /*#__PURE__*/React.createElement(\"p\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 19,\n      columnNumber: 17\n    }\n  }, \"\\u867D\\u7136\\u539F\\u5219\\u4E0A\\u8FD9\\u5E94\\u8BE5\\u662F\\u7EBF\\u7A0B\\u5F02\\u5E38\\u5904\\u7406\\u8303\\u7574\\u7684\\u95EE\\u9898\\uFF0C\\u4E0D\\u8FC7\\u540C\\u65F6\\u5B58\\u5728\\u4E0B\\u9762\\u8FD92\\u4E2A\\u95EE\\u9898\"), /*#__PURE__*/React.createElement(\"ul\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 21,\n      columnNumber: 17\n    }\n  }, /*#__PURE__*/React.createElement(\"li\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 22,\n      columnNumber: 17\n    }\n  }, /*#__PURE__*/React.createElement(\"code\", {\n    class: \"highlighter-rouge\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 22,\n      columnNumber: 21\n    }\n  }, \"write.lock\"), \" \\u6587\\u4EF6\\u6CA1\\u6709\\u88AB\\u53CA\\u65F6\\u91CA\\u653E\"), /*#__PURE__*/React.createElement(\"li\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 23,\n      columnNumber: 17\n    }\n  }, \"\\u5982\\u679C\\u4F7F\\u7528\\u7A0B\\u5E8F\\u5168\\u5C40\\u53D8\\u91CF\\u7684\\u9501\\u53C8\\u65E0\\u6CD5\\u5F88\\u597D\\u5730\\u7BA1\\u7406\\u548C\\u76D1\\u6D4B\")), /*#__PURE__*/React.createElement(\"p\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 26,\n      columnNumber: 17\n    }\n  }, \"\\u800C\\u5229\\u7528 Redis \\u7684\\u7279\\u6027\\u53BB\\u5B9E\\u73B0\\u4E92\\u65A5\\u9501\\u53EF\\u4EE5\\u5F88\\u597D\\u5730\\u89E3\\u51B3\\u8FD92\\u4E2A\\u95EE\\u9898\\uFF0C\\u539F\\u7406\\u975E\\u5E38\\u7B80\\u5355\"), /*#__PURE__*/React.createElement(\"ol\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 28,\n      columnNumber: 17\n    }\n  }, /*#__PURE__*/React.createElement(\"li\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 29,\n      columnNumber: 17\n    }\n  }, \"\\u9700\\u8981\\u52A0\\u9501\\u7684\\u65F6\\u5019\\uFF0C\\u751F\\u6210\\u4E00\\u4E2A lock_key\\uFF0Cexpire time \\u8BBE\\u7F6E\\u4E3A\\u4F30\\u8BA1\\u8BE5\\u7EBF\\u7A0B\\u6267\\u884C\\u5927\\u6982\\u7684\\u65F6\\u95F4\\uFF0C\\u5185\\u5BB9\\u53EF\\u4EE5\\u662F\\u7A7A\\u4E5F\\u53EF\\u4EE5\\u5C06\\u662F\\u54EA\\u4E2A\\u7EBF\\u7A0B\\u6216\\u4EC0\\u4E48\\u65F6\\u5019\\u4EA7\\u751F\\u7684\\u4FE1\\u606F\\u653E\\u5230\\u5185\\u5BB9\\u4E2D\"), /*#__PURE__*/React.createElement(\"li\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 30,\n      columnNumber: 17\n    }\n  }, \"\\u9501\\u7684\\u5224\\u5B9A\\uFF0C\\u5224\\u5B9A\\u4E0A\\u9762\\u751F\\u6210\\u7684 lock_key \\u662F\\u5426\\u5B58\\u5728\"), /*#__PURE__*/React.createElement(\"li\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 31,\n      columnNumber: 17\n    }\n  }, \"\\u7EBF\\u7A0B\\u8D44\\u6E90\\u7ADE\\u4E89\\u7684\\u90E8\\u5206\\u6267\\u884C\\u5B8C\\u540E\\uFF0C del lock_key \\u91CA\\u653E\\u8D44\\u6E90\")), /*#__PURE__*/React.createElement(\"p\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 34,\n      columnNumber: 17\n    }\n  }, \"\\u8FD9\\u6837\\u4E00\\u6765\\uFF0C\\u7531\\u4E8E\"), /*#__PURE__*/React.createElement(\"ul\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 36,\n      columnNumber: 17\n    }\n  }, /*#__PURE__*/React.createElement(\"li\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 37,\n      columnNumber: 17\n    }\n  }, \"Key \\u662F\\u6709\\u751F\\u5B58\\u671F\\u7684\\uFF0C\\u5373\\u4F7F\\u7EBF\\u7A0B\\u6302\\u6389\\u6CA1\\u6709\\u53CA\\u65F6\\u91CA\\u653E\\uFF0C\\u4F46\\u9501\\u5728\\u4E00\\u5B9A\\u65F6\\u9650\\u5185\\u8FD8\\u662F\\u4F1A\\u81EA\\u52A8\\u91CA\\u653E\\uFF0C\\u4E0D\\u5F71\\u54CD\\u540E\\u7EED\\u7ADE\\u4E89\\u8BE5\\u8D44\\u6E90\\u7684\\u7EBF\\u7A0B\\u7684\\u6267\\u884C\"), /*#__PURE__*/React.createElement(\"li\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 38,\n      columnNumber: 17\n    }\n  }, \"\\u9501\\u7684\\u72B6\\u6001\\u53EF\\u4EE5\\u901A\\u8FC7 Redis \\u7684\\u7BA1\\u7406\\u5DE5\\u5177\\u53CA\\u65F6\\u76D1\\u63A7\\u5F97\\u5230\"), /*#__PURE__*/React.createElement(\"li\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 39,\n      columnNumber: 17\n    }\n  }, \"Redis \\u57FA\\u4E8E\\u5185\\u5B58\\uFF0C\\u8BFB\\u5199\\u6548\\u7387\\u90FD\\u5F88\\u5FEB\"), /*#__PURE__*/React.createElement(\"li\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 40,\n      columnNumber: 17\n    }\n  }, \"Redis \\u672C\\u8EAB\\u5C31\\u662F\\u5355\\u7EBF\\u7A0B\\u6A21\\u578B\\u7684\\u5B9E\\u73B0\\uFF0C\\u6BD4\\u624B\\u52A8\\u5728\\u7A0B\\u5E8F\\u4E2D\\u5B9E\\u73B0\\u5355\\u4F8B\\u7684\\u9501\\u66F4\\u7B80\\u6D01\"))));\n};\n\nexport default Textcontent;","map":{"version":3,"sources":["/Users/guanlun/Documents/GitHub/myblog/src/components/Textcontent/Textcontent.js"],"names":["React","Textcontent"],"mappings":";AAAA,OAAOA,KAAP,MAAkB,OAAlB;AACA,OAAO,mBAAP;;AAEA,MAAMC,WAAW,GAAG,MAAM;AACtB,sBACI;AAAK,IAAA,SAAS,EAAC,aAAf;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,kBACI;AAAS,IAAA,EAAE,EAAC,eAAZ;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,kBACI;AAAI,IAAA,EAAE,EAAC,aAAP;AAAqB,uBAAgB,UAArC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,mDADJ,eAEI;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,4BAAI;AAAG,IAAA,IAAI,EAAC,kDAAR;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,0BAAJ,iPAA4F;AAAG,IAAA,IAAI,EAAC,kDAAR;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,0BAA5F,wQAFJ,eAII;AAAI,IAAA,EAAE,EAAC,SAAP;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,oBAJJ,eAMI;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,6EAAa;AAAG,IAAA,IAAI,EAAC,2BAAR;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,cAAb,2fANJ,eAQI;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,oNAAgD;AAAM,IAAA,KAAK,EAAC,mBAAZ;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,kBAAhD,kRAAmJ;AAAM,IAAA,KAAK,EAAC,mBAAZ;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,kBAAnJ,wKARJ,eAUI;AAAI,IAAA,EAAE,EAAC,WAAP;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,gCAVJ,eAYI;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,+MAZJ,eAcI;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,kBACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,kBAAI;AAAM,IAAA,KAAK,EAAC,mBAAZ;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,kBAAJ,4DADA,eAEA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,kJAFA,CAdJ,eAmBI;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,oMAnBJ,eAqBI;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,kBACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,+XADA,eAEA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,kHAFA,eAGA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,kIAHA,CArBJ,eA2BI;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,kDA3BJ,eA6BI;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,kBACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,oUADA,eAEA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,iIAFA,eAGA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,sFAHA,eAIA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,4LAJA,CA7BJ,CADJ,CADJ;AAyCH,CA1CD;;AA4CA,eAAeA,WAAf","sourcesContent":["import React from 'react';\nimport './Textcontent.css';\n\nconst Textcontent = () => {\n    return(\n        <div className='Textcontent'>\n            <article id=\"post__content\">\n                <h1 id=\"post__title\" data-identifier=\"20140903\">用 Redis 实现互斥锁</h1>\n                <p>在<a href=\"https://zh.wikipedia.org/wiki/多线程\">多线程</a>执行的程序下，无可避免的会遇到资源竞争的问题，为了解决资源竞争的问题，引入<a href=\"https://zh.wikipedia.org/wiki/互斥锁\">互斥锁</a>应该是公认的解决方案吧，而 Redis 的特性（基于内存，有生存期）我觉得非常适合用来实现互斥锁。</p>\n\n                <h2 id=\"section\">背景</h2>\n\n                <p>我遇到的问题是在对 <a href=\"https://lucene.apache.org\">Lucene</a> 更新索引的时候，原来采取的策略是将某个数据表增量的数据通过一个线程定期去更新和 flush 索引文件，但由于业务的扩展，原来的业务变成了从2个不同的数据表用2个不同的定期线程去更新。</p>\n\n                <p>这个时候问题来了，在 flush 到文件系统中的时候，虽然 Lucene 本身创建了一个 <code class=\"highlighter-rouge\">write.lock</code> 来避免文件冲突，但是由于线程中运行的程序在 flush 过程中可能因为异常导致线程直接中断，导致 <code class=\"highlighter-rouge\">write.lock</code> 文件没有被及时清除和处理，后续的索引更新线程全部作废。</p>\n\n                <h2 id=\"section-1\">解决方案</h2>\n\n                <p>虽然原则上这应该是线程异常处理范畴的问题，不过同时存在下面这2个问题</p>\n\n                <ul>\n                <li><code class=\"highlighter-rouge\">write.lock</code> 文件没有被及时释放</li>\n                <li>如果使用程序全局变量的锁又无法很好地管理和监测</li>\n                </ul>\n\n                <p>而利用 Redis 的特性去实现互斥锁可以很好地解决这2个问题，原理非常简单</p>\n\n                <ol>\n                <li>需要加锁的时候，生成一个 lock_key，expire time 设置为估计该线程执行大概的时间，内容可以是空也可以将是哪个线程或什么时候产生的信息放到内容中</li>\n                <li>锁的判定，判定上面生成的 lock_key 是否存在</li>\n                <li>线程资源竞争的部分执行完后， del lock_key 释放资源</li>\n                </ol>\n\n                <p>这样一来，由于</p>\n\n                <ul>\n                <li>Key 是有生存期的，即使线程挂掉没有及时释放，但锁在一定时限内还是会自动释放，不影响后续竞争该资源的线程的执行</li>\n                <li>锁的状态可以通过 Redis 的管理工具及时监控得到</li>\n                <li>Redis 基于内存，读写效率都很快</li>\n                <li>Redis 本身就是单线程模型的实现，比手动在程序中实现单例的锁更简洁</li>\n                </ul>\n\n            </article> \n        </div>\n     )\n};\n\nexport default Textcontent;"]},"metadata":{},"sourceType":"module"}